package com.erha.ops.entity;

import jakarta.persistence.*;
import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;

@Entity
@Table(name = "quotes")
@Data
public class Quote {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "quote_id")  // ← CRITICAL FIX: Added this line!
    private Long quoteId;

    @Column(name = "quote_number", unique = true, nullable = false, length = 50)
    private String quoteNumber;

    @Column(name = "rfq_id")
    private Long rfqId;

    @Column(name = "job_id")  // ← NEW: Added for job linking
    private Long jobId;

    @Column(name = "client_id")
    private Long clientId;

    @Column(name = "quote_date")
    private LocalDate quoteDate;

    @Column(name = "valid_until_date")
    private LocalDate validUntilDate;

    @Column(name = "value_excl_vat", precision = 15, scale = 2)
    private BigDecimal valueExclVat;

    @Column(name = "value_incl_vat", precision = 15, scale = 2)
    private BigDecimal valueInclVat;

    @Enumerated(EnumType.STRING)
    @Column(name = "quote_status", length = 50, columnDefinition = "VARCHAR(50) COLLATE utf8mb4_0900_as_cs")
    private QuoteStatus quoteStatus;

    @Column(name = "notes", columnDefinition = "TEXT")
    private String notes;

    @Column(name = "created_date")
    private LocalDateTime createdDate;

    @Column(name = "updated_date")
    private LocalDateTime updatedDate;

    @PrePersist
    protected void onCreate() {
        createdDate = LocalDateTime.now();
        updatedDate = LocalDateTime.now();
        if (quoteDate == null) {
            quoteDate = LocalDate.now();
        }
    }

    @PreUpdate
    protected void onUpdate() {
        updatedDate = LocalDateTime.now();
    }

    // QuoteStatus Enum
    public enum QuoteStatus {
        DRAFT,          // Quote is being prepared
        SUBMITTED,      // Quote has been submitted for approval/review
        SENT,           // Quote has been sent to client
        UNDER_REVIEW,   // Client is reviewing the quote
        ACCEPTED,       // Client accepted the quote
        REJECTED,       // Client rejected the quote
        EXPIRED,        // Quote validity period has expired
        WITHDRAWN,      // Quote was withdrawn
        SUPERSEDED      // Replaced by a newer quote version
    }
}
